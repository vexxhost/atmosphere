[tox]
minversion = 4
skipsdist = True

[testenv:molecule]
deps =
  molecule
  molecule-plugins[docker]
  # TODO(mnaser): We should remove these once we have an actual installable
  #               Python package and drop `skipsdist`.
  docker-image-py
  jmespath
  netaddr
  openstacksdk<0.99.0
  rjsonnet

[testenv:molecule-keycloak]
deps =
  {[testenv:molecule]deps}
commands =
  molecule test -s keycloak

[testenv:molecule-csi-{rbd,local-path-provisioner}]
deps =
  {[testenv:molecule]deps}
setenv =
  rbd: MOLECULE_CSI_DRIVER = rbd
  local-path-provisioner: MOLECULE_CSI_DRIVER = local-path-provisioner
commands =
  molecule test -s csi

[testenv:molecule-aio-{openvswitch,ovn}]
deps =
  {[testenv:molecule]deps}
setenv =
  ATMOSPHERE_DEBUG = true
  openvswitch: ATMOSPHERE_NETWORK_BACKEND = openvswitch
  ovn: ATMOSPHERE_NETWORK_BACKEND = ovn
commands =
  molecule test -s aio
