# Copyright (c) 2022 VEXXHOST, Inc.
#
# Licensed under the Apache License, Version 2.0 (the "License"); you may
# not use this file except in compliance with the License. You may obtain
# a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
# License for the specific language governing permissions and limitations
# under the License.

_openstack_helm_octavia_values:
  endpoints: "{{ openstack_helm_endpoints }}"
  images:
    tags:
      bootstrap: "{{ openstack_helm_octavia_image_repository }}/heat:{{ openstack_helm_octavia_heat_image_tag }}"
      db_drop: "{{ openstack_helm_octavia_image_repository }}/heat:{{ openstack_helm_octavia_heat_image_tag }}"
      db_init: "{{ openstack_helm_octavia_image_repository }}/heat:{{ openstack_helm_octavia_heat_image_tag }}"
      dep_check: "{{ openstack_helm_octavia_image_repository }}/kubernetes-entrypoint:latest"
      ks_endpoints: "{{ openstack_helm_octavia_image_repository }}/heat:{{ openstack_helm_octavia_heat_image_tag }}"
      ks_service: "{{ openstack_helm_octavia_image_repository }}/heat:{{ openstack_helm_octavia_heat_image_tag }}"
      ks_user: "{{ openstack_helm_octavia_image_repository }}/heat:{{ openstack_helm_octavia_heat_image_tag }}"
      rabbit_init: "{{ openstack_helm_octavia_image_repository }}/rabbitmq:3.8.23-management"
      octavia_api: "{{ openstack_helm_octavia_image_repository }}/octavia:{{ openstack_helm_octavia_image_tag }}"
      octavia_db_sync: "{{ openstack_helm_octavia_image_repository }}/octavia:{{ openstack_helm_octavia_image_tag }}"
      octavia_health_manager: "{{ openstack_helm_octavia_image_repository }}/octavia:{{ openstack_helm_octavia_image_tag }}"
      octavia_health_manager_init: "{{ openstack_helm_octavia_image_repository }}/heat:{{ openstack_helm_octavia_heat_image_tag }}"
      octavia_housekeeping: "{{ openstack_helm_octavia_image_repository }}/octavia:{{ openstack_helm_octavia_image_tag }}"
      octavia_worker: "{{ openstack_helm_octavia_image_repository }}/octavia:{{ openstack_helm_octavia_image_tag }}"
      openvswitch_vswitchd: "{{ openstack_helm_octavia_image_repository }}/neutron:{{ openstack_helm_octavia_neutron_image_tag }}"
  pod:
    mounts:
      octavia_api:
        octavia_api:
          volumeMounts:
            - name: octavia-certs
              mountPath: "/etc/octavia/certs/private/cakey.pem"
              subPath: "cakey.pem"
            - name: octavia-certs
              mountPath: "/etc/octavia/certs/ca_01.pem"
              subPath: "ca_01.pem"
            - name: octavia-certs
              mountPath: "/etc/octavia/certs/client.pem"
              subPath: "client.pem"
          volumes:
            - name: octavia-certs
              secret:
                secretName: octavia-certs
      octavia_worker:
        octavia_worker:
          volumeMounts:
            - name: octavia-certs
              mountPath: "/etc/octavia/certs/private/cakey.pem"
              subPath: "cakey.pem"
            - name: octavia-certs
              mountPath: "/etc/octavia/certs/ca_01.pem"
              subPath: "ca_01.pem"
            - name: octavia-certs
              mountPath: "/etc/octavia/certs/client.pem"
              subPath: "client.pem"
          volumes:
            - name: octavia-certs
              secret:
                secretName: octavia-certs
      octavia_housekeeping:
        octavia_housekeeping:
          volumeMounts:
            - name: octavia-certs
              mountPath: "/etc/octavia/certs/private/cakey.pem"
              subPath: "cakey.pem"
            - name: octavia-certs
              mountPath: "/etc/octavia/certs/ca_01.pem"
              subPath: "ca_01.pem"
            - name: octavia-certs
              mountPath: "/etc/octavia/certs/client.pem"
              subPath: "client.pem"
          volumes:
            - name: octavia-certs
              secret:
                secretName: octavia-certs
      octavia_health_manager:
        octavia_health_manager:
          volumeMounts:
            - name: octavia-certs
              mountPath: "/etc/octavia/certs/private/cakey.pem"
              subPath: "cakey.pem"
            - name: octavia-certs
              mountPath: "/etc/octavia/certs/ca_01.pem"
              subPath: "ca_01.pem"
            - name: octavia-certs
              mountPath: "/etc/octavia/certs/client.pem"
              subPath: "client.pem"
          volumes:
            - name: octavia-certs
              secret:
                secretName: octavia-certs
    replicas:
      api: 3
      worker: 3
      housekeeping: 3
  conf:
    octavia:
      DEFAULT:
        log_config_append: null
      certificates:
        ca_private_key_passphrase: null
        endpoint_type: internalURL
      cinder:
        endpoint_type: internalURL
      controller_worker:
        amp_boot_network_list: "{{ _openstack_helm_octavia_management_network.id }}"
        amp_flavor_id: "{{ _openstack_helm_octavia_amphora_flavor.id }}"
        amp_image_owner_id: "{{ _openstack_helm_octavia_amphora_image.image.owner }}"
        amp_secgroup_list: "{{ _openstack_helm_octavia_amphora_sg.id }}"
        amp_ssh_key_name: null
        workers: 4
      glance:
        endpoint_type: internalURL
      health_manager:
        controller_ip_port_list: "{{ _openstack_helm_octavia_controller_ip_port_list | join(',') }}"
        heartbeat_key: "{{ openstack_helm_octavia_heartbeat_key }}"
      oslo_messaging_notifications:
        driver: noop
      neutron:
        endpoint_type: internalURL
      nova:
        endpoint_type: internalURL
      service_auth:
        endpoint_type: internalURL
  manifests:
    ingress_api: false
    service_ingress_api: false
