- name: Copy Flux CLI binary from download dir
  ansible.builtin.copy:
    src: "{{ flux_download_unarchive_dest }}/flux"
    dest: "{{ flux_bin_dir }}/flux"
    mode: "0755"
    remote_src: true

- name: Remove Flux CLI orphaned binary
  ansible.builtin.file:
    path: /usr/bin/flux
    state: absent
  when: flux_bin_dir != "/usr/bin"

- name: Install Flux to cluster
  run_once: true
  changed_when: false
  ansible.builtin.command: flux install {% if atmosphere_image_repository is defined %}--registry={{ atmosphere_image_repository }}{% endif %}
